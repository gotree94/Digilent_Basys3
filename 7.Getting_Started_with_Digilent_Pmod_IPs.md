# 🚀 Digilent Pmod IPs 시작하기 (Getting Started with Digilent Pmod IPs)

## 📘 개요 (Overview)

**Digilent Pmod IPs**는 **Vivado 및 Xilinx SDK 2019.1 이하 버전에서만 지원**됩니다.

Digilent은 FPGA에서 Pmod를 간단히 사용할 수 있도록 설계된 여러 **Pmod용 IP 코어**를 제공합니다.  
이 가이드는 **Vivado MicroBlaze 또는 Zynq 설계**에서 Pmod IP 코어를 사용하는 방법을 설명합니다.

이 튜토리얼을 마치면, **Digilent Pmod IP 코어를 사용하는 Vivado 설계 및 데모**를 완성할 수 있습니다.

---

## 🧩 지원 플랫폼 (Platforms Supported)

| 플랫폼 | 프로세서 종류 |
|---------|---------------|
| Arty A7 | MicroBlaze |
| Arty S7 | MicroBlaze |
| Arty Z7 | Zynq |
| Basys 3 | MicroBlaze |
| Cmod A7 | MicroBlaze |
| Cmod S7 | MicroBlaze |
| Cora Z7 | Zynq |
| Genesys2 | MicroBlaze |
| Nexys4 | MicroBlaze |
| Nexys4-DDR | MicroBlaze |
| Nexys Video | MicroBlaze |
| Zybo | Zynq |
| Zybo Z7 | Zynq |

---

## 🔌 지원 Pmod 목록 (Pmods Supported)

| Pmod | 인터페이스 | 클록(MHz) | 클록 이름 | 인터럽트 핀 | PmodGPIO 사용 | 추가 정보 |
|------|-------------|------------|------------|---------------|----------------|------------|
| 8LD | GPIO | - | - | - | Yes | - |
| ACL | SPI | 80 | ext_spi_clk | - | - | - |
| ACL2 | SPI | 50 | ext_spi_clk | - | - | - |
| AD1 | SPI | - | - | - | - | - |
| AD2 | IIC | - | - | - | - | - |
| ALS | SPI | 50 | ext_spi_clk | - | - | - |
| AMP2 | GPIO | - | - | timer_interrupt | - | - |
| BLE | UART | - | - | - | - | - |
| BTN | GPIO | - | - | - | Yes | - |
| CAN | SPI | 100 | ext_spi_clk | SPI_interrupt, GPIO_interrupt | - | - |
| CLS | SPI | 50 | ext_spi_clk | - | - | - |
| COLOR | IIC | - | - | - | - | - |
| DA1 | SPI | 50 | ext_spi_clk | - | - | - |
| GYRO | SPI | 50 | ext_spi_clk | - | - | - |
| OLED | SPI/GPIO | - | - | - | - | - |
| OLEDrgb | SPI/GPIO | 50 | ext_spi_clk | - | - | - |
| PIR | GPIO | - | - | - | - | - |
| SWT | GPIO | - | - | - | Yes | - |
| TMP3 | IIC | - | - | - | - | - |
| WIFI | SPI | - | - | WF_INTERRUPT | - | 385 KB의 BRAM 또는 DDR 필요 |

---

## ⚙️ 사전 준비 (Prerequisites)

### 하드웨어
- 지원되는 **Digilent 7-Series FPGA 보드**
- **MicroUSB 케이블**
- 하나 이상의 **Digilent Pmod**

### 소프트웨어
- **Xilinx Vivado 2018.2** (Xilinx SDK 포함)
- **Digilent Board Files** 설치 필요  
- **Digilent Vivado IP Library** 설치 필요  
  → `vivado-library/ip/Pmods/your_pmod` 폴더의 README 참고

---

## 🧠 튜토리얼 단계 (Tutorial Steps)

### 1️⃣ 새 MicroBlaze/Zynq 블록 디자인 생성
- 플랫폼에 따라 MicroBlaze 또는 Zynq를 선택  
  (위 표 참고)
- **MicroBlaze** → "Getting Started with Vivado IP Integrator" 튜토리얼 참조  
- **Zynq** → "Getting Started with Vivado IP Integrator" 튜토리얼 참조

---

### 2️⃣ Digilent 라이브러리 추가
1. Digilent의 **vivado-library repository** 최신 릴리즈 다운로드  
   예: `vivado-library-v2018.2.zip`  
2. 압축 해제 후 Vivado에서  
   `Project Settings → IP → Repository Manager`  
   → `Add` 버튼 → `vivado-library` 폴더 선택

---

### 3️⃣ Pmod 추가
1. **Board 탭** 열기  
2. Pmod 섹션에서 원하는 커넥터 더블 클릭  
3. 사용하려는 **Pmod IP** 선택  
   (예: `PmodOLEDrgb`)  
4. 단순 GPIO 기반 Pmod는 **PmodGPIO IP** 사용 가능

---

### 4️⃣ 자동 연결 실행 (Run Connection Automation)
- “Run Connection Automation” 클릭  
- Pmod IP 옆 체크박스 선택 후 OK

---

### 5️⃣ 참조 클록 연결 (Reference Clock)
> 일부 Pmod는 클록 입력이 필요합니다.  
> 필요 여부는 위 표의 “Reference Clock” 항목을 확인하세요.

#### 🔹 Zynq 플랫폼
1. ZYNQ Processing System → `Clock Configuration`  
2. `PL Fabric Clocks` → 새로운 `FCLK_CLK` 활성화  
3. 필요한 주파수 설정 (예: 50 MHz 등)  
4. 해당 클록을 Pmod IP의 클록 입력에 연결

#### 🔹 MicroBlaze (MIG 사용)
1. MIG 설정 창 → `Select Additional Clocks`  
2. 필요한 주파수 선택  
3. 새 클록을 Pmod IP에 연결

#### 🔹 MicroBlaze (MIG 미사용)
1. `Clocking Wizard` → Output Clocks 탭  
2. 새 클록 출력 활성화  
3. 주파수 설정 → Pmod IP에 연결

---

### 6️⃣ 인터럽트 연결 (Interrupts)
> 일부 Pmod는 인터럽트가 필요합니다.  
> 필요 여부는 “Interrupt pin name/s” 열 참고.

#### 🔹 Zynq
1. ZYNQ PS → `Interrupts` → `Fabric Interrupts` → `IRQ_F2P` 활성화  
2. **Concat IP** 추가  
3. Pmod IP의 인터럽트 → Concat 입력  
4. Concat 출력 → Zynq의 IRQ_F2P에 연결

#### 🔹 MicroBlaze
1. AXI Interrupt Controller 추가  
2. Pmod IP의 인터럽트 → Concat 입력  
3. Concat 출력 → AXI Interrupt Controller의 intr 포트 연결

---

### 7️⃣ 디자인 검증 (Validate Design)
1. “Regenerate Layout” 클릭  
2. “Validate Design” 실행  
3. HDL Wrapper 생성  
   → `Sources` 탭 → 블록 디자인 우클릭 → `Create HDL Wrapper`

---

### 8️⃣ Bitstream 생성 (Generate Bit File)
1. 상단 메뉴에서 **Generate Bitstream** 클릭  
2. Synthesis → Implementation → Bitstream 순서로 실행  
3. 완료 후 “Cancel” 클릭 (Implemented Design 열 필요 없음)

---

### 9️⃣ 하드웨어 내보내기 (Export Hardware to SDK)
1. `File → Export → Export Hardware`  
   → **Include Bitstream** 체크 후 OK  
2. `.sysdef` 및 `.hdf` 파일 생성  
3. `File → Launch SDK` 실행  
   → 기본 설정 그대로 OK

---

### 🔟 Xilinx SDK에서 하드웨어 확인
- SDK에서 `system.hdf` 파일이 하드웨어 정보를 포함  
- `/drivers` 폴더에 Pmod용 드라이버 존재  
- 수정 시 `libsrc` 폴더 내 드라이버 파일 사용

---

### 1️⃣1️⃣ 새 Application 프로젝트 생성
1. SDK 상단 `New → Application Project`  
2. 이름 입력 → `Empty Application` 선택 → OK  
3. 새 프로젝트와 BSP 생성  
   - `lscript.ld` 파일 포함 (메모리 맵 정보)

---

### 1️⃣2️⃣ 예제 프로젝트 가져오기
- `design_1_wrapper_platform_0/drivers/Pmod.../examples` 폴더의  
  예제 파일들을 **project_name/src** 폴더에 복사

---

### 1️⃣3️⃣ FPGA 프로그래밍 (Program FPGA)
1. 보드 전원 및 USB 연결  
2. SDK 상단 “Program FPGA” 클릭  
3. Bitstream 다운로드 완료

---

### 1️⃣4️⃣ 프로세서 실행 (Run on Processor)
1. UART 터미널 설정  
   - **Zynq**: 115200 baud  
   - **MicroBlaze**: UARTLite 설정에 따름  
2. `Run As → Launch on Hardware (System Debugger)`  
3. 프로그램 실행 후 `main.c` 출력 확인  

---

## ✅ 참고 팁 (Tips)
- Pmod IP별 **README** 파일 확인 필수  
- Vivado와 SDK 간 수정 시  
  **Bitstream 재생성 및 Export Hardware 반복 필요**
- 인터럽트 및 클록 설정은 Pmod별로 다름

---

**출처:**  
[Digilent Reference – Getting Started with Pmod IPs](https://digilent.com/reference/programmable-logic/)  
© Digilent, Inc.
